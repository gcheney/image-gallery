(function(){angular.module("imageGalleryApp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,a){e.when("/",{templateUrl:"home/home.view.html",controller:"homeController",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"aboutController",controllerAs:"vm"}).when("/images/:imageid",{templateUrl:"/imageDetail/imageDetail.view.html",controller:"imageDetailController",controllerAs:"vm"}).when("/users/:username",{templateUrl:"/users/users.view.html",controller:"usersController",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerController",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginController",controllerAs:"vm"});e.otherwise({redirectTo:"/"});a.html5Mode(true)}angular.module("imageGalleryApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("imageGalleryApp").controller("homeController",e);e.$inject=["$scope","imageGalleryData","$location","$modal","authentication"];function e(e,a,t,r,n){var o=this;o.message="Loading images...";o.isLoggedIn=n.isLoggedIn();o.currentPath=t.path();o.featuredImage={};a.getAllImages().success(function(e){o.message=e.length>0?"":"No images found";if(e.length%2!==0){o.featuredImage=e.shift()}o.data={images:e}}).error(function(e){o.message="Sorry, there was an error with our system";console.log(e)});o.showError=function(a){e.$apply(function(){o.message=a.message})};o.addImageModal=function(){var e=r.open({templateUrl:"/addImageModal/addImageModal.view.html",controller:"addImageModalController as vm"});e.result.then(function(e){o.data.images.unshift(e);if(o.data.images.length%2!==0){o.featuredImage=o.data.images.shift()}else{o.data.images.splice(1,0,o.featuredImage);o.featuredImage={}}})};o.hasFeaturedImage=function(){return o.featuredImage.hasOwnProperty("url")}}})();(function(){angular.module("imageGalleryApp").controller("aboutController",e);function e(){var e=this;e.pageHeader={title:"About The Image Gallery"};e.main={content:'The Image Gallery was created by <a href="https://glendoncheney.com" target="_blank">Glendon Cheney</a> as a place for people to upload their favorite images.\n\n It was created using the MEAN stack, is open source and maintained on <a href="https://github.com/gcheney/image-gallery" target="_blank">Github.</a>'}}})();(function(){angular.module("imageGalleryApp").controller("registerController",e);e.$inject=["$location","authentication"];function e(e,a){var t=this;t.pageHeader={title:"Register for The Image Gallery"};t.credentials={username:"",password:""};t.returnPage=e.search().page||"/";t.onSubmit=function(){t.formError="";if(!t.credentials.username){t.formError="Please enter your new username";return false}else if(!t.credentials.password){t.formError="Please enter your password";return false}else{t.doRegister()}};t.doRegister=function(){t.formError="";a.register(t.credentials).error(function(e){t.formError=e.message}).then(function(){e.search("page",null);e.path(t.returnPage)})}}})();(function(){angular.module("imageGalleryApp").controller("loginController",e);e.$inject=["$location","authentication"];function e(e,a){var t=this;t.pageHeader={title:"Login To The Image Gallery"};t.credentials={username:"",password:""};t.returnPage=e.search().page||"/";t.onSubmit=function(){t.formError="";if(!t.credentials.username){t.formError="Please enter your username";return false}else if(!t.credentials.password){t.formError="Please enter your password";return false}else{t.doLogin()}};t.doLogin=function(){t.formError="";a.login(t.credentials).error(function(e){t.formError=e.message}).then(function(){e.search("page",null);e.path(t.returnPage)})}}})();(function(){angular.module("imageGalleryApp").controller("imageDetailController",e);e.$inject=["$scope","$routeParams","$location","$modal","imageGalleryData","authentication"];function e(e,a,t,r,n,o){var i=this;i.imageid=a.imageid;i.isLoggedIn=o.isLoggedIn();i.currentPath=t.path();n.getImageById(i.imageid).success(function(e){i.data={image:e};if(i.isLoggedIn){var a=i.data.image.creator;i.userIsImageCreator=l(a);var t=o.getCurrentUser().username;i.hasLiked=i.data.image.likes.includes(t)}}).error(function(e){console.log(e)});i.commentModal=function(){var e=r.open({templateUrl:"/commentModal/commentModal.view.html",controller:"commentModalController as vm",resolve:{imageData:function(){return{imageid:i.imageid,imageTitle:i.data.image.title}}}});e.result.then(function(e){i.data.image.comments.push(e)})};i.updateImageModal=function(){var e=r.open({templateUrl:"/updateImageModal/updateImageModal.view.html",controller:"updateImageModalController as vm",resolve:{imageData:function(){return{imageid:i.imageid,title:i.data.image.title,description:i.data.image.description}}}});e.result.then(function(e){i.data.image.title=e.title;i.data.image.description=e.description})};i.deleteImageModal=function(){var e=r.open({templateUrl:"/deleteImageModal/deleteImageModal.view.html",controller:"deleteImageModalController as vm",resolve:{imageData:function(){return{imageid:i.imageid,imageTitle:i.data.image.title}}}})};i.updateImageLikes=function(){if(!o.isLoggedIn()){i.error="You need to log in to like an image";return}n.updateLikesById(i.imageid,i.data).success(function(e){i.data.image.likes=e.likes;var a=o.getCurrentUser().username;i.hasLiked=i.data.image.likes.includes(a)}).error(function(e){console.log(e)})};i.updateCommentModal=function(e){var a=r.open({templateUrl:"/updateCommentModal/updateCommentModal.view.html",controller:"updateCommentModalController as vm",resolve:{imageData:function(){return{imageid:i.imageid,comment:e}}}});a.result.then(function(a){var t=i.data.image.comments;var r=t.indexOf(e);if(r!==-1){t[r]=a}i.data.image.comments=t;console.log(i.data.image.comments)})};e.deleteComment=function(e){n.deleteCommentById(i.imageid,e._id).success(function(){var a=i.data.image.comments;var t=a.indexOf(e);if(t>-1){a.splice(t,1)}i.data.image.comments=a}).error(function(e){console.log(e)})};e.isCommentAuthor=function(e){return o.isLoggedIn()?l(e):false};function l(e){return o.getCurrentUser().username===e}}})();(function(){angular.module("imageGalleryApp").controller("usersController",e);e.$inject=["$routeParams","$scope","imageGalleryData","$location","$modal","authentication"];function e(e,a,t,r,n,o){var i=this;i.message="Loading images...";i.isLoggedIn=o.isLoggedIn();i.currentPath=r.path();i.username=e.username;i.currentUsersAccount=l(i.username);t.getImagesByUsername(i.username).success(function(e){i.message=e.length>0?"":"No images found";i.data={images:e}}).error(function(e){i.message="Sorry, there was an error with our system";console.log(e)});i.showError=function(e){a.$apply(function(){i.message=e.message})};i.addImageModal=function(){var e=n.open({templateUrl:"/addImageModal/addImageModal.view.html",controller:"addImageModalController as vm"});e.result.then(function(e){i.data.images.unshift(e)})};function l(e){return o.isLoggedIn()&&o.getCurrentUser().username===e}}})();(function(){angular.module("imageGalleryApp").controller("commentModalController",e);e.$inject=["$modalInstance","imageGalleryData","imageData"];function e(e,a,t){var r=this;r.imageData=t;r.onSubmit=function(){r.formError="";if(!r.formData){r.formError="All fields are required.";return false}else if(!r.formData.content){r.formError="Please leave a comment.";return false}else{r.addComment(r.imageData.imageid,r.formData)}};r.addComment=function(e,t){a.addCommentById(e,{content:t.content}).success(function(e){r.modal.close(e)}).error(function(e){r.formError="Comment not saved, please try again."});return false};r.modal={close:function(a){e.close(a)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("imageGalleryApp").controller("updateCommentModalController",e);e.$inject=["$modalInstance","imageGalleryData","imageData"];function e(e,a,t){var r=this;r.imageData=t;r.formData={};r.formData.content=r.imageData.comment.content;r.onSubmit=function(){r.formError="";if(!r.formData){r.formError="All fields are required.";return false}else if(!r.formData.content){r.formError="Please leave a comment.";return false}else{r.addComment(r.imageData.imageid,r.formData)}};r.addComment=function(e,t){var n=r.imageData.comment._id;a.updateCommentById(e,n,{content:t.content}).success(function(e){r.modal.close(e)}).error(function(e){r.formError="Comment not updated, please try again."});return false};r.modal={close:function(a){e.close(a)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("imageGalleryApp").controller("addImageModalController",e);e.$inject=["$modalInstance","imageGalleryData"];function e(e,a){var t=this;t.onSubmit=function(){t.formError="";if(!t.formData){t.formError="All fields are required.";return false}else if(!t.formData.url){t.formError="Please provide the image URL";return false}else{t.addImage(t.formData)}};t.addImage=function(e){a.addNewImage(e).success(function(e){t.modal.close(e)}).error(function(e){t.formError="Your image was not saved, please try again."});return false};t.modal={close:function(a){e.close(a)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("imageGalleryApp").controller("updateImageModalController",e);e.$inject=["authentication","$modalInstance","imageGalleryData","imageData"];function e(e,a,t,r){var n=this;n.imageData=r;n.onSubmit=function(){n.formError="";if(!n.imageData){n.formError="All fields are required.";return false}else if(!n.imageData.title){n.formError="Please provide the image title";return false}else if(!n.imageData.description){n.formError="Please provide the image description";return false}else{n.updateImage(n.imageData)}};n.updateImage=function(e){t.updateImageById(e.imageid,e).success(function(e){n.modal.close(e)}).error(function(e){console.log(e)})};n.modal={close:function(e){a.close(e)},cancel:function(){a.dismiss("cancel")}}}})();(function(){angular.module("imageGalleryApp").controller("deleteImageModalController",e);e.$inject=["$location","authentication","$modalInstance","imageGalleryData","imageData"];function e(e,a,t,r,n){var o=this;o.imageData=n;o.onSubmit=function(){o.deleteImage(o.imageData.imageid)};o.deleteImage=function(n){var o=a.getCurrentUser().username;r.deleteImageById(n).success(function(){t.close();e.path("/users/"+o)}).error(function(e){console.log(e)})};o.modal={close:function(){t.close()},cancel:function(){t.dismiss("cancel")}}}})();(function(){angular.module("imageGalleryApp").controller("navigationController",e);e.$inject=["$location","authentication"];function e(e,a){var t=this;t.currentPath=e.path();t.isLoggedIn=a.isLoggedIn();t.currentUser=a.getCurrentUser();t.logout=function(){a.logout();e.path("/")}}})();(function(){angular.module("imageGalleryApp").service("imageGalleryData",e);e.$inject=["$http","authentication"];function e(e,a){var t=function(){return e.get("/api/images")};var r=function(a){return e.get("/api/images/"+a)};var n=function(a){return e.get("/api/images/"+"?user="+a)};var o=function(t){return e.post("/api/images",t,{headers:{Authorization:"Bearer "+a.getToken()}})};var i=function(t,r){return e.put("/api/images/"+t,r,{headers:{Authorization:"Bearer "+a.getToken()}})};var l=function(t){return e.delete("/api/images/"+t,{headers:{Authorization:"Bearer "+a.getToken()}})};var m=function(t,r){return e.post("/api/images/"+t+"/comments",r,{headers:{Authorization:"Bearer "+a.getToken()}})};var s=function(t,r,n){var o="/api/images/"+t+"/comments/"+r;return e.put(o,n,{headers:{Authorization:"Bearer "+a.getToken()}})};var u=function(t,r){var n="/api/images/"+t+"/comments/"+r;return e.delete(n,{headers:{Authorization:"Bearer "+a.getToken()}})};var c=function(t,r){return e.put("/api/images/"+t+"/likes",r,{headers:{Authorization:"Bearer "+a.getToken()}})};return{getAllImages:t,getImageById:r,addNewImage:o,updateImageById:i,deleteImageById:l,addCommentById:m,updateCommentById:s,deleteCommentById:u,getImagesByUsername:n,updateLikesById:c}}})();(function(){angular.module("imageGalleryApp").service("authentication",e);e.$inject=["$window","$http","$route"];function e(e,a,t){var r=function(a){e.localStorage["imageGallery-token"]=a};var n=function(){return e.localStorage["imageGallery-token"]};var o=function(e){return a.post("/api/register",e).success(function(e){r(e.token)})};var i=function(e){return a.post("/api/login",e).success(function(e){r(e.token)})};var l=function(){e.localStorage.removeItem("imageGallery-token");t.reload()};var m=function(){var a=n();if(a){var t=JSON.parse(e.atob(a.split(".")[1]));return t.exp>Date.now()/1e3}else{return false}};var s=function(){if(m()){var a=n();var t=JSON.parse(e.atob(a.split(".")[1]));return{username:t.username}}};return{saveToken:r,getToken:n,register:o,login:i,logout:l,isLoggedIn:m,getCurrentUser:s}}})();(function(){angular.module("imageGalleryApp").directive("footerBasic",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerBasic/footerBasic.template.html"}}})();(function(){angular.module("imageGalleryApp").directive("imageHover",e);function e(){return{restrict:"EA",link:function(e,a,t){a.hover(function(){$(this).addClass("transition")},function(){$(this).removeClass("transition")})}}}})();(function(){angular.module("imageGalleryApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationController as navvm"}}})();(function(){angular.module("imageGalleryApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();(function(){angular.module("imageGalleryApp").filter("addHtmlLineBreaks",e);function e(){return function(e){return e.replace(/\n/g,"<br/>")}}})();