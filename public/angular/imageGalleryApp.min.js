(function(){angular.module("imageGalleryApp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,r){e.when("/",{templateUrl:"home/home.view.html",controller:"homeController",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"aboutController",controllerAs:"vm"}).when("/images/:imageid",{templateUrl:"/imageDetail/imageDetail.view.html",controller:"imageDetailController",controllerAs:"vm"}).when("/users/:username",{templateUrl:"/users/users.view.html",controller:"usersController",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerController",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginController",controllerAs:"vm"}).otherwise({redirectTo:"/"});r.html5Mode(true)}angular.module("imageGalleryApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("imageGalleryApp").controller("homeController",e);e.$inject=["$scope","imageGalleryData","$location","$modal","authentication"];function e(e,r,a,t,n){var o=this;o.message="Loading images...";o.isLoggedIn=n.isLoggedIn();o.currentPath=a.path();r.getAllImages().success(function(e){o.message=e.length>0?"":"No images found";o.data={images:e}}).error(function(e){o.message="Sorry, there was an error with our system";console.log(e)});o.showError=function(r){e.$apply(function(){o.message=r.message})};o.addImageModal=function(){var e=t.open({templateUrl:"/addImageModal/addImageModal.view.html",controller:"addImageModalController as vm"});e.result.then(function(e){o.data.images.unshift(e)})}}})();(function(){angular.module("imageGalleryApp").controller("aboutController",e);function e(){var e=this;e.pageHeader={title:"About The Image Gallery"};e.main={content:'The Image Gallery was created by Glendon Cheney as a place for people to upload their favorite images.\n\n It was created using the MEAN stack, is open source and maintained on <a href="https://github.com/gcheney/image-gallery">Github.</a>'}}})();(function(){angular.module("imageGalleryApp").controller("registerController",e);e.$inject=["$location","authentication"];function e(e,r){var a=this;a.pageHeader={title:"Register for The Image Gallery"};a.credentials={username:"",password:""};a.returnPage=e.search().page||"/";a.onSubmit=function(){a.formError="";if(!a.credentials.username){a.formError="Please enter your new username";return false}else if(!a.credentials.password){a.formError="Please enter your password";return false}else{a.doRegister()}};a.doRegister=function(){a.formError="";r.register(a.credentials).error(function(e){a.formError=e.message}).then(function(){e.search("page",null);e.path(a.returnPage)})}}})();(function(){angular.module("imageGalleryApp").controller("loginController",e);e.$inject=["$location","authentication"];function e(e,r){var a=this;a.pageHeader={title:"Login To The Image Gallery"};a.credentials={username:"",password:""};a.returnPage=e.search().page||"/";a.onSubmit=function(){a.formError="";if(!a.credentials.username){a.formError="Please enter your username";return false}else if(!a.credentials.password){a.formError="Please enter your password";return false}else{a.doLogin()}};a.doLogin=function(){a.formError="";r.login(a.credentials).error(function(e){a.formError=e.message}).then(function(){e.search("page",null);e.path(a.returnPage)})}}})();(function(){angular.module("imageGalleryApp").controller("imageDetailController",e);e.$inject=["$routeParams","$location","$modal","imageGalleryData","authentication"];function e(e,r,a,t,n){var o=this;o.imageid=e.imageid;o.isLoggedIn=n.isLoggedIn();o.currentPath=r.path();t.getImageById(o.imageid).success(function(e){o.data={image:e};if(o.isLoggedIn){var r=o.data.image.creator;o.userIsImageCreator=i(r)}}).error(function(e){console.log(e)});o.commentModal=function(){var e=a.open({templateUrl:"/commentModal/commentModal.view.html",controller:"commentModalController as vm",resolve:{imageData:function(){return{imageid:o.imageid,imageTitle:o.data.image.title}}}});e.result.then(function(e){o.data.image.comments.push(e)})};o.deleteImage=function(){t.deleteImageById(o.imageid).success(function(){r.path("/")}).error(function(e){console.log(e)})};function i(e){return n.getCurrentUser().username===e}}})();(function(){angular.module("imageGalleryApp").controller("usersController",e);e.$inject=["$routeParams","$scope","imageGalleryData","$location","$modal","authentication"];function e(e,r,a,t,n,o){var i=this;i.message="Loading images...";i.isLoggedIn=o.isLoggedIn();i.currentPath=t.path();i.username=e.username;i.currentUsersAccount=l(i.username);a.getImagesByUsername(i.username).success(function(e){i.message=e.length>0?"":"No images found";i.data={images:e}}).error(function(e){i.message="Sorry, there was an error with our system";console.log(e)});i.showError=function(e){r.$apply(function(){i.message=e.message})};i.addImageModal=function(){var e=n.open({templateUrl:"/addImageModal/addImageModal.view.html",controller:"addImageModalController as vm"});e.result.then(function(e){i.data.images.unshift(e)})};function l(e){return o.isLoggedIn()&&o.getCurrentUser().username===e}}})();(function(){angular.module("imageGalleryApp").controller("commentModalController",e);e.$inject=["$modalInstance","imageGalleryData","imageData"];function e(e,r,a){var t=this;t.imageData=a;t.onSubmit=function(){t.formError="";if(!t.formData){t.formError="All fields are required.";return false}else if(!t.formData.content){t.formError="Please leave a comment.";return false}else{t.addComment(t.imageData.imageid,t.formData)}};t.addComment=function(e,a){r.addCommentById(e,{content:a.content}).success(function(e){t.modal.close(e)}).error(function(e){t.formError="Comment not saved, please try again."});return false};t.modal={close:function(r){e.close(r)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("imageGalleryApp").controller("addImageModalController",e);e.$inject=["$modalInstance","imageGalleryData"];function e(e,r){var a=this;a.onSubmit=function(){a.formError="";if(!a.formData){a.formError="All fields are required.";return false}else if(!a.formData.url){a.formError="Please provide the image URL";return false}else{a.addImage(a.formData)}};a.addImage=function(e){r.addNewImage(e).success(function(e){a.modal.close(e)}).error(function(e){a.formError="Your image was not saved, please try again."});return false};a.modal={close:function(r){e.close(r)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("imageGalleryApp").controller("navigationController",e);e.$inject=["$location","authentication"];function e(e,r){var a=this;a.currentPath=e.path();a.isLoggedIn=r.isLoggedIn();a.currentUser=r.getCurrentUser();a.logout=function(){r.logout();e.path("/")}}})();(function(){angular.module("imageGalleryApp").service("imageGalleryData",e);e.$inject=["$http","authentication"];function e(e,r){var a=function(){return e.get("/api/images")};var t=function(r){return e.get("/api/images/"+r)};var n=function(a){return e.post("/api/images",a,{headers:{Authorization:"Bearer "+r.getToken()}})};var o=function(a,t){return e.post("/api/images/"+a+"/comments",t,{headers:{Authorization:"Bearer "+r.getToken()}})};var i=function(a){return e.delete("/api/images/"+a,{headers:{Authorization:"Bearer "+r.getToken()}})};var l=function(r){return e.get("/api/images/"+"?user="+r)};return{getAllImages:a,getImageById:t,addNewImage:n,deleteImageById:i,addCommentById:o,getImagesByUsername:l}}})();(function(){angular.module("imageGalleryApp").service("authentication",e);e.$inject=["$window","$http"];function e(e,r){var a=function(r){e.localStorage["imageGallery-token"]=r};var t=function(){return e.localStorage["imageGallery-token"]};var n=function(e){return r.post("/api/register",e).success(function(e){a(e.token)})};var o=function(e){return r.post("/api/login",e).success(function(e){a(e.token)})};var i=function(){e.localStorage.removeItem("imageGallery-token")};var l=function(){var r=t();if(r){var a=JSON.parse(e.atob(r.split(".")[1]));return a.exp>Date.now()/1e3}else{return false}};var s=function(){if(l()){var r=t();var a=JSON.parse(e.atob(r.split(".")[1]));return{username:a.username}}};return{saveToken:a,getToken:t,register:n,login:o,logout:i,isLoggedIn:l,getCurrentUser:s}}})();(function(){angular.module("imageGalleryApp").directive("footerBasic",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerBasic/footerBasic.template.html"}}})();(function(){angular.module("imageGalleryApp").directive("imageHover",e);function e(){return{restrict:"EA",link:function(e,r,a){r.hover(function(){$(this).addClass("transition")},function(){$(this).removeClass("transition")})}}}})();(function(){angular.module("imageGalleryApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationController as navvm"}}})();(function(){angular.module("imageGalleryApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();(function(){angular.module("imageGalleryApp").filter("addHtmlLineBreaks",e);function e(){return function(e){return e.replace(/\n/g,"<br/>")}}})();